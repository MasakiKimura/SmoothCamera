using System;
using System.Collections.Generic;
using System.Linq;
using ICities;

namespace SmoothCamera
{
    public static class SmoothCameraSetting
    {
        private static readonly string[] ShadowQualityLabels =
{
            "None",
            "Low",
            "Middle",
            "High"
        };

        private static readonly string[] LevelOfDetailLabels =
        {
            "Low",
            "Middle",
            "High",
            "Excellent"
        };

        private static readonly string[] IntegerLabels =
        {
            "Disable",
            "5",
            "10",
            "15",
            "20",
            "25",
            "30",
            "35",
            "40",
            "45",
            "50",
            "55",
            "60",
        };

        private static readonly int[] IntegerValues =
        {
            0,
            5,
            10,
            15,
            20,
            25,
            30,
            35,
            40,
            45,
            50,
            55,
            60,
        };

        private static readonly string[] ToggleKeyCode =
        {
            "Disable",
            "G",
            "Ctrl + G",
            "Shift + G",
            "Alt + G",
            "Ctrl + Shift + G",
        };

        public static void OnSettingsUI(UIHelperBase helper, String versionString)
        {
            if (SmoothCamera.IsNeedToResetSetting)
            {
                SetDefaultValues();
            }

            // Load the configuration
            SmoothCameraConfiguration config = Configuration<SmoothCameraConfiguration>.Load();

            var group = helper.AddGroup("Smooth Camera " + versionString);

            //  Light weight shadow quality
            int lightWeightShadowQualitySelectedIndex = config.LightWeightShadowQuality;
            group.AddDropdown("Light weight shadow quality", ShadowQualityLabels, lightWeightShadowQualitySelectedIndex, sel =>
            {
                // Change config value and save config
                config.LightWeightShadowQuality = sel;
                Configuration<SmoothCameraConfiguration>.Save();
            });

            //  Light weight level of detail
            int lightWeightLevelOfDetailSelectedIndex = config.LightWeightLevelOfDetail;
            group.AddDropdown("Light weight level of detail", LevelOfDetailLabels, lightWeightLevelOfDetailSelectedIndex, sel =>
            {
                // Change config value and save config
                config.LightWeightLevelOfDetail = sel;
                Configuration<SmoothCameraConfiguration>.Save();
            });

            //  Return delay frame
            int returnDelayFrameSelectedIndex = GetSelectedOptionIndex(config.ReturnDalayFrame, IntegerValues);
            group.AddDropdown("Return delay frame (Default:5)", IntegerLabels, returnDelayFrameSelectedIndex, sel =>
            {
                // Change config value and save config
                config.ReturnDalayFrame = IntegerValues[sel];
                Configuration<SmoothCameraConfiguration>.Save();
            });

            //  ApplyThresholdFPS
            int applyThreasholdFPSSelectedIndex = GetSelectedOptionIndex(config.ApplyThresholdFPS, IntegerValues);
            group.AddDropdown("Apply only when FPS is slower than this value.(Default:Disable) ", IntegerLabels, applyThreasholdFPSSelectedIndex, sel =>
            {
                // Change config value and save config
                config.ApplyThresholdFPS = IntegerValues[sel];
                Configuration<SmoothCameraConfiguration>.Save();
            });

            int toggleKeyCodeIndex = config.ToggleKeyCode;
            group.AddDropdown("ToggleKeyCode.(Default:Ctrl + G) ", ToggleKeyCode, toggleKeyCodeIndex, sel =>
            {
                // Change config value and save config
                config.ToggleKeyCode = sel;
                Configuration<SmoothCameraConfiguration>.Save();
            });

            //  Dont apply when FreeCamera
            group.AddCheckbox("Don't apply when a FreeCamera mode is enabled.", config.DontApplyWhenFreeCamera, sel =>
            {
                config.DontApplyWhenFreeCamera = sel;
                Configuration<SmoothCameraConfiguration>.Save();
            });

        }

        public static void SetDefaultValues()
        {
            SmoothCameraConfiguration config = Configuration<SmoothCameraConfiguration>.Load();

            config.LightWeightShadowQuality = SmoothCameraConfiguration.LightWeightShadowQuality_DefaultValue;
            config.LightWeightLevelOfDetail = SmoothCameraConfiguration.LightWeightLevelOfDetail_DefaultValue;
            config.ReturnDalayFrame = SmoothCameraConfiguration.ReturnDalayFrame_DefaultValue;
            config.ApplyThresholdFPS = SmoothCameraConfiguration.ApplyThresholdFPS_DefaultValue;
            config.DontApplyWhenFreeCamera = SmoothCameraConfiguration.DontApplyWhenFreeCamera_DefaultValue;
            config.ToggleKeyCode = SmoothCameraConfiguration.ToggleKeyCode_DefaultValue;
            config.VersionInfo = SmoothCameraConfiguration.VersionInfo_DefaultValue;
            Configuration<SmoothCameraConfiguration>.Save();
        }

        public static bool HasChangedFromDefault()
        {
            SmoothCameraConfiguration config = Configuration<SmoothCameraConfiguration>.Load();

            bool sameAsDefault = config.LightWeightShadowQuality == SmoothCameraConfiguration.LightWeightShadowQuality_DefaultValue
                && config.LightWeightLevelOfDetail == SmoothCameraConfiguration.LightWeightLevelOfDetail_DefaultValue
                && config.ReturnDalayFrame == SmoothCameraConfiguration.ReturnDalayFrame_DefaultValue
                && config.ApplyThresholdFPS == SmoothCameraConfiguration.ApplyThresholdFPS_DefaultValue
                && config.DontApplyWhenFreeCamera == SmoothCameraConfiguration.DontApplyWhenFreeCamera_DefaultValue
                && config.ToggleKeyCode == SmoothCameraConfiguration.ToggleKeyCode_DefaultValue;

            return !sameAsDefault;
        }

        private static int GetSelectedOptionIndex(int value, int[] optionValues)
        {
            int index = Array.IndexOf(optionValues, value);
            if (index < 0) index = 0;

            return index;
        }
    }
}
